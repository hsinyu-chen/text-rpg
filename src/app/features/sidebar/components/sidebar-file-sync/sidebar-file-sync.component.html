<!-- Local File System Section -->
<div class="sync-section">
    <div class="section-header">
        <mat-icon>computer</mat-icon>
        <span class="section-title">Local File System</span>
    </div>

    <div class="folder-selection">
        @if (fileSystem.hasHandle()) {
        <div class="slot-info">
            <mat-icon class="slot-icon">folder</mat-icon>
            <span class="slot-name text-truncate-left" [matTooltip]="fileSystem.directoryHandle()?.name || ''">
                {{ fileSystem.directoryHandle()?.name }}
            </span>
            <button mat-icon-button (click)="loadFolder()" matTooltip="Change Local Folder">
                <mat-icon>edit</mat-icon>
            </button>
        </div>
        } @else {
        <div class="slot-info fade-text">
            <span class="slot-name">No Folder Selected</span>
            <button mat-icon-button (click)="loadFolder()" matTooltip="Select Local Folder">
                <mat-icon>add_link</mat-icon>
            </button>
        </div>
        }
    </div>

    <div class="action-grid">
        <button mat-flat-button color="primary" (click)="loadFilesOnly()"
            [disabled]="state.isBusy() || !fileSystem.hasHandle()" class="action-btn">
            <mat-icon>folder_open</mat-icon>
            Load
        </button>
        <button mat-stroked-button color="primary" (click)="syncToDisk()"
            [disabled]="state.isBusy() || !fileSystem.hasHandle() || state.loadedFiles().size === 0" class="action-btn">
            <mat-icon>sync</mat-icon>
            Sync
        </button>
    </div>

    <button mat-stroked-button color="primary" class="full-width save-slots-btn" (click)="openLocalSaveSlots()"
        [disabled]="state.isBusy() || !fileSystem.hasHandle()" style="margin-top: 8px;">
        @if (autoSave.isSaving()) {
        <mat-spinner diameter="20" style="display:inline-block; vertical-align:middle; margin-right:8px;"></mat-spinner>
        } @else {
        <mat-icon>bookmarks</mat-icon>
        }
        Local Save Slots
    </button>
</div>

<mat-divider style="margin: 16px 0"></mat-divider>

<!-- Google Drive Section -->
@if (driveService.isConfigured) {
<div class="sync-section">
    <div class="section-header">
        <mat-icon style="color: #4285f4;">cloud_queue</mat-icon>
        <span class="section-title">Google Drive</span>
    </div>

    <div class="folder-selection">
        @if (currentSlot()) {
        <div class="slot-info">
            <mat-icon class="slot-icon" style="color: #4285f4;">cloud</mat-icon>
            <span class="slot-name text-truncate">{{ currentSlot()?.name }}</span>
            <button mat-icon-button (click)="selectSlot()" matTooltip="Change Cloud Slot">
                <mat-icon>edit</mat-icon>
            </button>
        </div>
        } @else {
        <div class="slot-info fade-text">
            <span class="slot-name">No Slot Selected</span>
            <button mat-icon-button (click)="selectSlot()" matTooltip="Select Cloud Slot">
                <mat-icon>add_link</mat-icon>
            </button>
        </div>
        }
    </div>

    <div class="action-grid">
        <button mat-flat-button class="google-btn action-btn text-truncate" (click)="loadCloudFolder()"
            [disabled]="state.isBusy() || !currentSlot()">
            <mat-icon>cloud_download</mat-icon>
            Load
        </button>
        <button mat-stroked-button class="google-btn action-btn text-truncate" (click)="syncToCloud()"
            [disabled]="state.isBusy() || !currentSlot() || state.loadedFiles().size === 0">
            <mat-icon>cloud_sync</mat-icon>
            Sync
        </button>
    </div>

    <div class="row-actions" style="margin-top: 8px; display: flex; gap: 8px;">
        <button mat-stroked-button class="google-btn save-slots-btn" (click)="openSaveSlots()"
            [disabled]="state.isBusy() || !currentSlot()" style="flex: 1;">
            @if (autoSave.isSaving()) {
            <mat-spinner diameter="20"
                style="display:inline-block; vertical-align:middle; margin-right:8px;"></mat-spinner>
            } @else {
            <mat-icon>cloud_queue</mat-icon>
            }
            Cloud Save Slots
        </button>

        @if (showAuthWarning()) {
        <button mat-mini-fab color="warn" matTooltip="Connection Error. Click to Re-connect."
            (click)="reAuthenticate()">
            <mat-icon>warning</mat-icon>
        </button>
        }
    </div>
</div>
} @else {
<div class="sync-section disabled-section">
    <div class="hint-text">
        <mat-icon style="font-size: 18px; margin-bottom: -4px;">cloud_off</mat-icon>
        <br>
        Client ID not configured
    </div>
</div>
}